<!DOCTYPE html>
<html>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<head>
		<title>Save Admin Tool</title>
		<link rel="stylesheet" type="text/css" href="style.css">
		<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet"> 
	</head>
	<body>
		<div id="pageContainer">
			<ul>
				<li class="navBarTitle"><p class="whiteText">Save Admin Tool</p></li>
				<li><a href="settings.html" class="topLvl whiteText">Settings</a></li>
				<li class="dropdown">
					<a class="whiteText topLvl  active">Manage Accounts</a>
					<div class="dropdownContent">
						<a>Vendor Accounts</a>
						<a>User Accounts</a>
						<a>Admin Accounts</a>
					</div>
				</li>
				<li><a href="index.html" class="topLvl whiteText">Dashboard</a></li>
			</ul>
			<div id="vendorTitle">
				<div style="display: inline-block; width: 100%">
					<p class="lightGrayText vendorHeader">Vendor Accounts</p>
					<button class="vendorButton grayBg button whiteText">Notify</button>
					<button class="vendorButton greenBg button whiteText" onclick="uploadVendorData()">Upload</button>
					<button class="vendorButton greenBg button whiteText" onclick="downloadVendorData()">Download</button>
					<button class="vendorButton blueBg button whiteText">Settle</button>
				</div>
				<table id="recordTable">
					<thead>
						<tr id="vendorProperties">

						</tr>
					</tbody>
					<tbody id="vendorRecords">
						
					</tbody>
				</table>
				<div id="vendorRecordBg">

				</div>
			</div>
		</div>
	</body>
	
	<script src="https://www.gstatic.com/firebasejs/5.7.0/firebase.js"></script>
	<script>
		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyD_8xDR6m1kA5Xg3YDmbbEsKdxM8HpP-44",
			authDomain: "nussave-app.firebaseapp.com",
			databaseURL: "https://nussave-app.firebaseio.com",
			projectId: "nussave-app",
			storageBucket: "nussave-app.appspot.com",
			messagingSenderId: "770570652465"
		};
		firebase.initializeApp(config);

		// Creating column titles
		const columnNumber = 8;
		var divWidth = 100.0 / (columnNumber + 1);
		var columns = ["VendorID", "Name", "FoodcourtID", "Type", "Unsettled", "TotalRedeem", "Contact", "Password"];
		for (var i = 0; i < columnNumber; i++){
			var th = document.createElement("TD");
			var t = document.createTextNode(columns[i]);
			th.appendChild(t);
			th.style.textAlign = "right";
			th.style.fontSize = "75%";
			th.style.fontWeight = "600";
			th.className = "darkGrayText";
			document.getElementById("vendorProperties").appendChild(th);
		}

		// Grabbing data & show 
		var vendorDbRef = firebase.database().ref('/Vendor/');
		vendorDbRef.on('value', function(snapshot){
			var vendors = snapshot.val();
			vendors.forEach(element => {
				var division = document.createElement("DIV");
				var tr = document.createElement("TR");
				for (var i = 0; i < columnNumber; i++){
					var td = document.createElement("TD");
					var t = document.createTextNode(element[columns[i]]);
					td.appendChild(t);
					td.style.textAlign = "right";
					td.style.fontSize = "75%";
					tr.appendChild(td);
				}
				division.className = "vendorRecordFill";
				document.getElementById("vendorRecordBg").appendChild(division);
				document.getElementById("vendorRecords").appendChild(tr);
			});
		})

		// Button Functions
		function downloadVendorData(){
			vendorDbRef.once('value').then(function(snapshot){
				var content = new Array();
				content.push(columns.toString() + "\n");
				var vendors = snapshot.val();
				vendors.forEach(element => {
					var tempStr = "";
					for (var i = 0; i < columnNumber; i++){
						tempStr = tempStr + (element[columns[i]] + ",");
					}
					tempStr += "\n";
					content.push(tempStr);
				});
				console.log(content);
				var blob = new Blob(content, {type: 'text/csv'});
				if(window.navigator.msSaveOrOpenBlob) {
					window.navigator.msSaveBlob(blob, "vendorData.csv");
				}
				else{
					var elem = window.document.createElement('A');
					elem.href = window.URL.createObjectURL(blob);
					elem.download = "vendorData.csv";        
					document.body.appendChild(elem);
					elem.click();        
					document.body.removeChild(elem);
			}	
			});
		}

		function uploadVendorData(){
			var fileInput = document.createElement("INPUT");
			fileInput.type = "file";
			fileInput.accept = ".csv, text/csv";
			fileInput.style = "visibility: hidden";
			fileInput.addEventListener('change', uploadedEventHandler, false);
			document.body.appendChild(fileInput);
			fileInput.click();
		}

		function uploadedEventHandler() {
			const file = this.files[0];
		}

	</script>
</html>